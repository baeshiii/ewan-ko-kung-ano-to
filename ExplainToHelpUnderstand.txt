Line-by-line explanation using the KITCHEN analogy

IMPORT
import multiprocessing as mp

You’re hiring multiple cooks instead of one.


Safety check
def check_dimensions(A, B):

The head chef checks:
“Do these ingredients even work together?”


if len(A[0]) != len(B):

Makes sure the recipe makes sense.


raise ValueError(...)

Stop cooking if the ingredients don’t match.


UMA SECTION (One big shared fridge)

Worker
def multiply_row(args):

One cook prepares one dish.


A, B, row_index = args

The cook is told:
where ingredients are
which dish number to prepare


cols_B = len(B[0])
cols_A = len(A[0])

Count ingredients needed.


result_row = [0] * cols_B

Empty plate.


for j in range(cols_B):
    for k in range(cols_A):

Mixing ingredients from the shared fridge.


return row_index, result_row

Send finished dish back to head chef.


UMA Manager

def matrix_multiply_uma(A, B, workers=4):

Open kitchen with 4 cooks.


check_dimensions(A, B)

Final safety check.


rows_A = len(A)
result = [None] * rows_A

Table for finished dishes.


with mp.Pool(workers) as pool:

Kitchen opens.


tasks = [(A, B, i) for i in range(rows_A)]

Assign dishes.


results = pool.map(multiply_row, tasks)

All cooks work at the same time.


result[row_index] = row_value

Place dishes in order.


NUMA SECTION (Separate kitchens, separate fridges)

NUMA worker
def numa_worker(start_row, A_slice, B, output):

One cook works in their own station.


A_slice

Only local ingredients.


for i, row in enumerate(A_slice):

Cook assigned dishes only.


output[start_row + i] = result_row

Send food to the main serving table.


NUMA Manager

def matrix_multiply_numa(A, B, nodes=4):

Kitchen is split into stations.


nodes = min(nodes, rows_A)

Don’t hire more cooks than dishes.


chunk_size = (rows_A + nodes - 1) // nodes

Divide work evenly.


manager = mp.Manager()

Communication system between kitchens.


output = manager.list(...)

Shared delivery table.


p.start()

Start cooking.


p.join()

Wait until everyone finishes.


MAIN (Restaurant opens)
if __name__ == "__main__":

This is the restaurant entrance.
Windows won’t let cooks in without it.